test_that("level 0 brightness matches our expectations",{
  expect_equal(harmony.0.brightness_polarity(), c(1,-1,1,-1,1,-1,0,1,-1,1,-1,1,-1))
  expect_equal(harmony.0.brightness(), c( 0.12,-0.18,0.29,-2.00,2.00,-0.29,
                                          0.00,
                                          0.29,-2.00,2.00,-0.29,0.18,-0.12),tolerance=0.1)
})
test_that("brightness for chords matches our expectations",{

  expect_gt(brightness(c(0,4,7),0),0)
  expect_lt(brightness(c(0,3,7),0),0)
  expect_lt(brightness(c(0,3,7),12),0)
  expect_gt(brightness(c(3,0,-4),12),0)

  expect_lt(brightness(c(11,14,17),0),0)
  expect_equal(brightness(c(11,14,17),0),brightness(c(0,3,6),0))

  expect_lt( brightness(c(2,5,9),0) ,0)
  expect_gt( brightness(c(1,5,8),0) ,0)
  expect_gt( brightness(c(11,2,5),0) ,0)
  expect_gt( brightness(c(9,0,3),0) ,0)
  expect_lt(brightness(c(9,12,16),0),0)
  expect_gt(brightness(c(8,12,15),12),0)
  expect_gt(brightness(c(12,9,6),12),0)
  expect_lt(brightness(c(0,3,6),0),0)

  expect_equal( brightness(c(11,2,5),0), brightness(c(9,0,3),0))

  expect_gt(brightness(c(5,9,12),0),0)
  expect_gt(brightness(c(7,11,14),0),0)
  expect_gt(brightness(7,0),0)
  expect_lt(brightness(-5,0),0)
  expect_lt(brightness(-17,0),0)
})
test_that("triangular root brightness boundary works as expected", {
  expect_equal(harmony.0.brightness_boundary_triangular_root(),5)
})
test_that("the mean affinity of the minor/major 3rd and minor/major 6th are as expected", {
  expect_equal(harmony.0.brightness_boundary_3rds_and_6ths(),6.5)
})
test_that("brightness for intervals matches our expectations",{
  expect_gt(brightness(0,0),0)
  expect_gt(brightness(2,0),0)
  expect_gt(brightness(4,0),0)
  expect_lt(brightness(-8,0),0)
  expect_gt(brightness(7,0),0)
  expect_gt(brightness(9,0),0)
  expect_lt(brightness(-3,0),0)
  expect_gt(brightness(11,0),0)
  expect_equal(brightness(6,0),0)
  expect_lt(brightness(1,0),0)
  expect_lt(brightness(3,0),0)
  expect_gt(brightness(-9,0),0)
  expect_lt(brightness(5,0),0)
  expect_lt(brightness(8,0),0)
  expect_gt(brightness(-4,0),0)
  expect_lt(brightness(-4,0),12)
  expect_lt(brightness(10,0),0)
  expect_lt(brightness(12,0),0)
})

test_that("the diatonic modes are in the order of expected brightness", {
  expect_false(diatonic_scales() %>% purrr::map(brightness,0) %>% unlist %>% is.unsorted, "the scales should be in increasing order of brightness")
})

test_that("brightness.0 meets expectations", {
  expect_error(brightness.0(position=-1))
  expect_error(brightness.0(position=13))
  level = -3
  expect_equal(brightness.0(position=0,level=level),0.286,tolerance=0.001)
  expect_equal(brightness.0(position=3,level=level),-0.2222,tolerance=0.001)
  expect_equal(brightness.0(position=4,level=level),0.1818,tolerance=0.001)
  expect_equal(brightness.0(position=6,level=level),0,tolerance=0.001)
  expect_equal(brightness.0(position=8,level=level),-0.1818,tolerance=0.001)
  expect_equal(brightness.0(position=9,level=level),0.2222,tolerance=0.001)
  expect_equal(brightness.0(position=11,level=level),0.0952,tolerance=0.001)
  expect_equal(brightness.0(position=12,level=level),-0.286,tolerance=0.001)
  level = -2
  expect_equal(brightness.0(position=0,level=level),0.1818,tolerance=0.001)
  expect_equal(brightness.0(position=3,level=level),-0.4,tolerance=0.001)
  expect_equal(brightness.0(position=4,level=level),0.2857,tolerance=0.001)
  expect_equal(brightness.0(position=6,level=level),0,tolerance=0.001)
  expect_equal(brightness.0(position=8,level=level),-0.2857,tolerance=0.001)
  expect_equal(brightness.0(position=9,level=level),0.4,tolerance=0.001)
  expect_equal(brightness.0(position=11,level=level),0.1176,tolerance=0.001)
  expect_equal(brightness.0(position=12,level=level),-0.1818,tolerance=0.001)
  level = -1
  expect_equal(brightness.0(position=0,level=level),0.1333,tolerance=0.001)
  expect_equal(brightness.0(position=3,level=level),-2,tolerance=0.001)
  expect_equal(brightness.0(position=4,level=level),0.6666,tolerance=0.001)
  expect_equal(brightness.0(position=6,level=level),0,tolerance=0.001)
  expect_equal(brightness.0(position=8,level=level),-0.6666,tolerance=0.001)
  expect_equal(brightness.0(position=9,level=level),2,tolerance=0.001)
  expect_equal(brightness.0(position=11,level=level),0.1538,tolerance=0.001)
  expect_equal(brightness.0(position=12,level=level),-0.1333,tolerance=0.001)
  # level 0
  expect_equal(brightness.0(position=0),0.1176,tolerance=0.001)
  expect_equal(brightness.0(position=1),-0.1818,tolerance=0.001)
  expect_equal(brightness.0(position=6),0,tolerance=0.001)
  expect_equal(brightness.0(position=11),0.1818,tolerance=0.001)
  expect_equal(brightness.0(position=12),-0.1176,tolerance=0.001)
  level = 1
  expect_equal(brightness.0(position=0,level=level),0.1333,tolerance=0.001)
  expect_equal(brightness.0(position=3,level=level),-2,tolerance=0.001)
  expect_equal(brightness.0(position=4,level=level),0.6666,tolerance=0.001)
  expect_equal(brightness.0(position=6,level=level),0,tolerance=0.001)
  expect_equal(brightness.0(position=8,level=level),-0.6666,tolerance=0.001)
  expect_equal(brightness.0(position=9,level=level),2,tolerance=0.001)
  expect_equal(brightness.0(position=11,level=level),0.1538,tolerance=0.001)
  expect_equal(brightness.0(position=12,level=level),-0.1333,tolerance=0.001)
  level = 2
  expect_equal(brightness.0(position=0,level=level),0.1818,tolerance=0.001)
  expect_equal(brightness.0(position=3,level=level),-0.4,tolerance=0.001)
  expect_equal(brightness.0(position=4,level=level),0.2857,tolerance=0.001)
  expect_equal(brightness.0(position=6,level=level),0,tolerance=0.001)
  expect_equal(brightness.0(position=8,level=level),-0.2857,tolerance=0.001)
  expect_equal(brightness.0(position=9,level=level),0.4,tolerance=0.001)
  expect_equal(brightness.0(position=11,level=level),0.1176,tolerance=0.001)
  expect_equal(brightness.0(position=12,level=level),-0.1818,tolerance=0.001)
  level = 3
  expect_equal(brightness.0(position=0,level=level),0.286,tolerance=0.001)
  expect_equal(brightness.0(position=3,level=level),-0.2222,tolerance=0.001)
  expect_equal(brightness.0(position=4,level=level),0.1818,tolerance=0.001)
  expect_equal(brightness.0(position=6,level=level),0,tolerance=0.001)
  expect_equal(brightness.0(position=8,level=level),-0.1818,tolerance=0.001)
  expect_equal(brightness.0(position=9,level=level),0.2222,tolerance=0.001)
  expect_equal(brightness.0(position=11,level=level),0.0952,tolerance=0.001)
  expect_equal(brightness.0(position=12,level=level),-0.286,tolerance=0.001)
})
